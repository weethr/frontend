!function e(t,n,i){function s(a,o){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!o&&c)return c(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return s(n?n:e)},u,u.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)s(i[a]);return s}({"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/CityList.jsx":[function(e,t,n){"use strict";function i(e){return e=Math.round(e),e>0?"+"+e:e}var s=e("react"),r=e("strftime");t.exports=s.createClass({displayName:"exports",onRemove:function(e){var t=this;return function(){t.props.onRemove(e)}},onMoveUp:function(e){var t=this;return function(){t.props.onMoveUp(e)}},onMoveDown:function(e){var t=this;return function(){t.props.onMoveDown(e)}},getIconCode:function(e){switch(e){case"01d":return"B";case"02d":return"H";case"03d":return"N";case"04d":return"Y";case"09d":return"R";case"10d":return"Q";case"11d":return"P";case"13d":return"V";case"50d":return"M";case"01n":return"2";case"02n":return"4";case"03n":return"5";case"04n":return"%";case"09n":return"8";case"10n":return"7";case"11n":return"6";case"13n":return'"';case"50n":return"M";default:return")"}},render:function(){function e(e){return e.substr(0,1).toUpperCase()+e.substr(1)}var t=this;return s.createElement("div",{className:"city-list"},this.props.data.length>0?this.props.data.map(function(n){var a="city__temp";return n.weather.temp>0?a+=" city__temp--warm":n.weather.temp<0&&(a+=" city__temp--cold"),"full"===t.props.displayMode?s.createElement("table",{key:n.name,className:"city city--full"},s.createElement("tbody",null,s.createElement("tr",null,s.createElement("td",{className:"city__icon"},s.createElement("i",{"aria-hidden":"true",className:"meteoicon",title:e(n.weather.desc.description)},t.getIconCode(n.weather.desc.icon))),s.createElement("td",{className:"city__name",colSpan:"2"},n.name)),s.createElement("tr",null,s.createElement("td",{className:a},i(n.weather.temp)),s.createElement("td",{className:"city__details"},s.createElement("div",null,s.createElement("span",{className:"city__aux-param"},"Pressure: ",n.weather.pressure," hPa"),s.createElement("span",{className:"city__aux-param"},"Humidity: ",n.weather.humidity,"%"),s.createElement("span",{className:"city__aux-param"},"Wind: ",n.weather.wind.speed," m/s (",n.weather.wind.deg,"°)")),s.createElement("div",{className:"city__last-update"},"Last update: ",r("%T %F",new Date(n.weather.dt))))),s.createElement("tr",null,s.createElement("td",{className:"city__remove-button",colSpan:"3"},s.createElement("div",{className:"city__controls"},s.createElement("div",{className:"arrow-up",onClick:t.onMoveUp(n.name)}),s.createElement("div",{className:"arrow-down",onClick:t.onMoveDown(n.name)}),s.createElement("button",{onClick:t.onRemove(n.name)},"Remove")))))):s.createElement("table",{key:n.name,className:"city city--short"},s.createElement("tbody",null,s.createElement("tr",null,s.createElement("td",{className:"city__icon"},s.createElement("i",{"aria-hidden":"true",className:"meteoicon",title:e(n.weather.desc.description)},t.getIconCode(n.weather.desc.icon))),s.createElement("td",{className:"city__name"},n.name),s.createElement("td",{className:a},i(n.weather.temp)),s.createElement("td",{className:"city__controls-parent"},s.createElement("div",{className:"city__controls"},s.createElement("div",{className:"city__remove-button",rowSpan:"2"},s.createElement("button",{onClick:t.onRemove(n.name)},"Remove")),s.createElement("div",{className:"city__up-down-buttons",rowSpan:"2"},s.createElement("div",{className:"arrow-up",onClick:t.onMoveUp(n.name)}),s.createElement("div",{className:"arrow-down",onClick:t.onMoveDown(n.name)})))))))}):s.createElement("div",{className:"city-list__empty"},"There are no cities added yet"))}})},{react:"react",strftime:"strftime"}],"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/DynamicSelect.js":[function(e,t,n){"use strict";var i=e("react");t.exports=i.createClass({displayName:"exports",getInitialState:function(){return{text:"",focused:!1,blurDisabled:!1,highlightedOption:null,optionList:[]}},onFocus:function(e){this.setState({focused:!0})},onBlur:function(e){this.state.blurDisabled||this.setState({focused:!1,text:"",optionList:[]})},onInput:function(e){var t=this,n=e.target.value;this.setState({text:n,highlightedOption:null},function(){t.props.loadOptions(t.state.text).then(function(e){t.setState(function(t){if(t.text===n){var i=[];return e.forEach(function(e){0===i.filter(function(t){return e.value===t.value}).length&&i.push(e)}),{optionList:i}}return t})},function(e){t.setState(function(e){return e.text===n?{optionList:[]}:e})})})},onSelect:function(e){var t=this;this.setState({text:"",optionList:[],blurDisabled:!1,focused:!1},function(){t.props.onChange(e)})},onMouseOverOptionList:function(){this.setState({blurDisabled:!0})},onMouseOutOptionList:function(){this.setState({blurDisabled:!1})},onMouseOverOption:function(e){this.setState({highlightedOption:e})},onMouseOutOption:function(){this.setState({highlightedOption:null})},onReset:function(){var e=this;this.setState({text:"",optionList:[]},function(){e.props.onReset&&e.props.onReset()})},onKeyDown:function(e){40===e.keyCode?(this.setState(function(e){var t=e.optionList,n=e.highlightedOption;if(0!==t.length){if(null===n)return{highlightedOption:t[0]};for(var i=0;i<t.length;++i)if(t[i].value===n.value)return i===t.length-1?{highlightedOption:t[0]}:{highlightedOption:t[i+1]}}return e}),e.preventDefault()):38===e.keyCode?(this.setState(function(e){var t=e.optionList,n=e.highlightedOption;if(0!==t.length){if(null===n)return{highlightedOption:t[0]};for(var i=0;i<t.length;++i)if(t[i].value===n.value)return 0===i?{highlightedOption:t[t.length-1]}:{highlightedOption:t[i-1]}}return e}),e.preventDefault()):13===e.keyCode?(null!==this.state.highlightedOption&&this.onSelect(this.state.highlightedOption),e.preventDefault()):9===e.keyCode?null!==this.state.highlightedOption&&this.onSelect(this.state.highlightedOption):27===e.keyCode&&(this.onReset(),e.preventDefault())},render:function(){var e=this,t="dynamic-select";this.state.focused&&(t+=" dynamic-select--focused");var n=this.props.value||{value:"",label:""};return i.createElement("div",{className:t},i.createElement("input",{id:this.props.id,className:"dynamic-select__input",type:"text",placeholder:this.state.focused||""!==this.state.text?"":this.props.placeholder,value:this.state.focused?this.state.text:n.label,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onInput,onClick:this.onClick,onKeyDown:this.onKeyDown,autoComplete:"off",ref:"inp"}),i.createElement("div",{className:"dynamic-select__reset",onClick:this.onReset},"✖"),i.createElement("div",{className:"dynamic-select__option-list",onMouseOver:this.onMouseOverOptionList,onMouseOut:this.onMouseOutOptionList},0===this.state.optionList.length?i.createElement("div",{className:"dynamic-select__option dynamic-select__option--nothing-found"},"Nothing found"):this.state.optionList.map(function(t){var n="dynamic-select__option";return null!==e.state.highlightedOption&&e.state.highlightedOption.value===t.value&&(n+=" dynamic-select__option--highlighted"),i.createElement("div",{key:t.value,className:n,onMouseOver:function(n){return e.onMouseOverOption(t)},onMouseOut:function(t){return e.onMouseOutOption()},onClick:function(n){n.preventDefault(),e.onSelect(t)}},t.label)})))}})},{react:"react"}],"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/NewCity.jsx":[function(e,t,n){"use strict";var i=e("react"),s=e("./ajax"),r=e("./DynamicSelect");t.exports=i.createClass({displayName:"exports",onSubmit:function(e){var t=this;e.preventDefault(),this.setState({waiting:!0});var n=this.props.onAdd(this.state.selectValue.value);n.then(function(){t.setState({error:null})})["catch"](function(e){var n;n=404==e.code?"city have not found":500==e.code?"internal server error. Sorry :(":e.message,t.setState({error:"Unable to add city '"+e.city+"': "+n})}).then(function(){t.setState({selectValue:null,waiting:!1})})},getInitialState:function(){return{selectValue:null,waiting:!1,error:null}},loadOptions:function(e){return s.get(window.context.backend_url+"/cities?q="+e).then(function(e){return e.map(function(e){return{value:e.city,label:e.city}})})},onFinishSearch:function(e){this.setState({selectValue:e})},onSelectReset:function(){this.setState({selectValue:null})},render:function(){return i.createElement("div",{className:"new-city"},i.createElement("form",{onSubmit:this.onSubmit,className:"new-city__form"},i.createElement("div",{className:"new-city__item"},i.createElement("label",{htmlFor:"city"},i.createElement("span",null,"Add city: "))),i.createElement("div",{className:"new-city__item"},i.createElement(r,{id:"city",loadOptions:this.loadOptions,value:this.state.selectValue,onReset:this.onSelectReset,onChange:this.onFinishSearch,placeholder:"Begin writing city name"})),i.createElement("div",{className:"new-city__item"},i.createElement("button",{type:"submit",disabled:this.props.disabled||this.state.waiting||null===this.state.selectValue||""===this.state.selectValue.value,ref:"add_button"},"Add")),i.createElement("div",{className:"new-city__item new-city__item--empty"},i.createElement("div",{className:"new-city__loader"},i.createElement("img",{src:"images/ajax-loader.gif",style:{visibility:this.state.waiting?"visible":"hidden"}})))),this.state.error?i.createElement("div",{className:"error"},this.state.error):null)}})},{"./DynamicSelect":"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/DynamicSelect.js","./ajax":"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/ajax.js",react:"react"}],"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/Root.jsx":[function(e,t,n){"use strict";var i=e("react"),s=e("react-addons-update"),r=(e("./ajax"),e("es6-promise").Promise),a=e("./NewCity"),o=e("./CityList"),c=e("./data_access.js");t.exports=i.createClass({displayName:"exports",getInitialState:function(){var e,t=this,n={initialized:!1,cityList:[],displayMode:"full"};localStorage.getItem("reactState");if(null!==localStorage.getItem("reactState"))try{e=JSON.parse(localStorage.getItem("reactState"))}catch(i){console.error("Unable to parse old state, use default"),e=n}else e=n;if(!e.initialized){var r=function(){t.setState(function(e){var n=s(e,{initialized:{$set:!0}});return t.saveState(n),n})};setTimeout(r,12e3),c.fetchCurrentCity().then(function(e){return c.fetchWeather(e)}).then(function(e){t.setState(function(n){if(n.initialized)return n;var i;return i=s(n,{cityList:{$push:[e]}}),t.saveState(i),i})})["catch"](function(e){console.error(e)}).then(function(){r()})}return this.saveState(e),e},saveState:function(e){e=e||this.state,localStorage.setItem("reactState",JSON.stringify(e))},componentDidMount:function(){var e=this,t=function n(){var t=e.state.cityList.map(function(e){return c.fetchWeather(e.name)});t.forEach(function(t){t.then(function(t){e.setState(function(e){var n=e.cityList.map(function(e){return e.name===t.name?t:e});return s(e,{cityList:{$set:n}})})})["catch"](function(e){console.error("Failed to update '"+e.city+"': "+e.message)})}),t=t.map(function(e){return e["catch"](function(e){return r.resolve(e)})}),r.all(t).then(function(){e.saveState(),setTimeout(n,1e4)})};t()},onNewCity:function(e){var t=this,n=c.fetchWeather(e);return n.then(function(i){return t.setState(function(n){var r,a=0===n.cityList.filter(function(t){return t.name===e}).length;return r=a?s(n,{cityList:{$push:[i]}}):n,t.saveState(r),r}),n})},onRemoveCity:function(e){var t=this;this.setState(function(n){var i=n.cityList.filter(function(t){return t.name!==e}),r=s(n,{cityList:{$set:i}});return t.saveState(r),r})},onChangeDisplayMode:function(e,t){var n=this;this.setState(function(e){var t="full"===n.state.displayMode?"short":"full",i=s(e,{displayMode:{$set:t}});return n.saveState(i),i})},onMoveCityUp:function(e){this.setState(function(t){for(var n=t.cityList.slice(0),i=1;i<n.length;i++)if(n[i].name===e){var r=n[i-1];n[i-1]=n[i],n[i]=r;break}return s(t,{cityList:{$set:n}})})},onMoveCityDown:function(e){this.setState(function(t){for(var n=t.cityList.slice(0),i=0;i<n.length-1;i++)if(n[i].name===e){var r=n[i+1];n[i+1]=n[i],n[i]=r;break}return s(t,{cityList:{$set:n}})})},render:function(){return i.createElement("div",{className:"l-root"},i.createElement("div",{className:"l-row "},i.createElement("div",{className:"l-cell l-header"},this.state.initialized?null:i.createElement("p",{className:"initializing-msg"},"Determining current city..."),i.createElement(a,{onAdd:this.onNewCity}))),i.createElement("div",{className:"l-row"},i.createElement("div",{className:"l-cell"},i.createElement("div",{className:"l-content"},i.createElement(o,{data:this.state.cityList,displayMode:this.state.displayMode,onRemove:this.onRemoveCity,onMoveUp:this.onMoveCityUp,onMoveDown:this.onMoveCityDown})))),i.createElement("div",{className:"l-row"},i.createElement("div",{className:"l-cell l-footer"},i.createElement("div",{className:"l-content"},i.createElement("div",{className:"display-settings"},i.createElement("label",null,i.createElement("input",{type:"checkbox",checked:"full"===this.state.displayMode,onChange:this.onChangeDisplayMode})," show detailed information"))))))}})},{"./CityList":"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/CityList.jsx","./NewCity":"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/NewCity.jsx","./ajax":"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/ajax.js","./data_access.js":"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/data_access.js","es6-promise":"es6-promise",react:"react","react-addons-update":"react-addons-update"}],"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/ajax.js":[function(e,t,n){"use strict";var i=e("es6-promise").Promise;t.exports.get=function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=void 0;return new i(function(i,s){n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){if(n.readyState==XMLHttpRequest.DONE)if(200==n.status)if(n.responseText)try{i(JSON.parse(n.responseText))}catch(e){console.error("Response text is not null, but it's not a valid JSON: "+n.responseText),i(null)}else i(null);else s({code:n.status,responseText:n.responseText})},n.withCredentials=t.withCredentials!==!1,n.open("GET",e,!0),n.send()})},t.exports.post=function(e,t){return new i(function(n,i){var s=void 0;s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),s.onreadystatechange=function(){if(s.readyState==XMLHttpRequest.DONE)if(200==s.status)if(s.responseText)try{n(JSON.parse(s.responseText))}catch(e){console.error("Response text is not null, but it's not a valid JSON: "+s.responseText),n(null)}else n(null);else i({code:s.status,responseText:s.responseText})},s.withCredentials=!0,s.open("POST",e,!0),s.send(JSON.stringify(t))})}},{"es6-promise":"es6-promise"}],"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/data_access.js":[function(e,t,n){"use strict";var i=e("es6-promise").Promise,s=e("./ajax");t.exports.fetchWeather=function(e){return s.get(window.context.backend_url+"/weather?q="+e).then(function(t){return{name:e,weather:{temp:t.main.temp||0,pressure:t.main.pressure,humidity:t.main.humidity,dt:1e3*t.dt,wind:t.wind,desc:t.weather[0]}}},function(t){return i.reject({code:t.code,city:e,message:t.responseText})})},t.exports.fetchCurrentCity=function(){var e=new i(function(e,t){navigator.geolocation.getCurrentPosition(function(t){e(t)},function(e){t(e)})});return e.then(function(e){var t="http://maps.googleapis.com/maps/api/geocode/json?latlng="+e.coords.latitude+","+e.coords.longitude+"&sensor=true&language=en";return s.get(t,{withCredentials:!1})}).then(function(e){if(!e.results.length>0)throw new Error("Google hasn't found anything");var t=e.results[0],n=t.address_components;if(n=n.filter(function(e){return-1!=e.types.indexOf("administrative_area_level_1")&&-1!=e.types.indexOf("political")}),!n.length>0)throw new Error("City component hasn't found");var i=n[0],s=i.long_name;return s})}},{"./ajax":"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/ajax.js","es6-promise":"es6-promise"}],"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/main.js":[function(e,t,n){"use strict";var i=e("react"),s=e("react-dom"),r=e("./Root");"PROD"===window.context.env&&"http:"===window.location.protocol&&(window.location.href=window.location.href.replace(/^http/,"https")),document.addEventListener("DOMContentLoaded",function(){s.render(i.createElement(r,null),document.getElementById("react"))})},{"./Root":"/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/Root.jsx",react:"react","react-dom":"react-dom"}]},{},["/Users/koluch/Dropbox/dev/js/weethr/weethr.github.io/src/scripts/main.js"]);